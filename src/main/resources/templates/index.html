<!DOCTYPE html>
<html lang="ja"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
>
<head>
    <title>トップページ</title>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script th:inline="javascript">
      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        
        // Thymeleafからタスクリストを受け取る
        var tasks = /*[[${taskList}]]*/ [];
        
        // FullCalendar用のイベント形式に変換
        var calendarEvents = tasks.map(function(task) {
            return {
                title: task.summary,
                start: task.deadline,
                url: '/tasks/' + task.id,
                backgroundColor: getStatusColor(task.status),
                borderColor: getStatusColor(task.status)
            };
        }).filter(function(event) {
            return event.start != null; // 期限がないタスクは除外
        });

        function getStatusColor(status) {
            if (status === 'TODO') return '#0d6efd'; // Primary
            if (status === 'DOING') return '#ffc107'; // Warning
            if (status === 'DONE') return '#198754'; // Success
            return '#6c757d'; // Secondary
        }

        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          locale: 'ja',
          height: 'auto',
          events: calendarEvents
        });
        calendar.render();
      });
    </script>
</head>
<body>
<section layout:fragment="content">
    <div class="text-center mb-4">
        <h1 class="h1">タスク管理カレンダー</h1>
    </div>
    <div id='calendar'></div>
</section>
</body>
</html>
